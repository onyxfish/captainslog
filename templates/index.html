<head>
    <title>Captain's Log</title>
</head>
<body>
    <div id='wrapper' class="container_12">
    <h1>Captain's Log</h1>
    
    <div id="rail" class="grid_2">
    Source:
    <ul name='source'>
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_source == 'All' else '' }' title='All'>All</a></li>
        % for source in sources:
        <li><a href="javascript:facet_clicked();" class="facet ${ 'selected' if selected_source == source else '' }" title='${ source }'>${ source }</a></li>
        % endfor
    </ul>
    
    Date range:
    <ul name='when'>
        <li><a href="javascript:facet_clicked();" class="facet ${ 'selected' if selected_when == 'All' else '' }" title='All'>All</a></li>
        % for when in whens:
        <li><a href="javascript:facet_clicked();" class="facet ${ 'selected' if selected_when == when else '' }" title='${ when }'>${ when }</a></li>
        % endfor
    </ul>
    
    Host:
    <ul name='host'>
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_host == 'All' else '' }' title='All'>All</a></li>
        % for host in hosts:
        <li><a href="javascript:facet_clicked();" class="facet ${ 'selected' if selected_host == host else '' }" title='${ host }'>${ host }</a></li>
        % endfor
    </ul>
    
    Path:
    <ul name='path'>
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_path == 'All' else '' }' title='All'>All</a></li>
        % for path in paths:
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_path == path else '' }' title='${ path }'>${ path }</a></li>
        % endfor
    </ul>
    
    Status Code:
    <ul name='statuscode'>
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_statuscode == 'All' else '' }' title='All'>All</a></li>
        % for statuscode in statuscodes:
        <li><a href="javascript:facet_clicked();" class='facet ${ 'selected' if selected_statuscode == statuscode else '' }' title='${ statuscode }'>${ statuscode }</a></li>
        % endfor
    </ul>
    </div>
    
    <div id="content" class="grid_10">
        <table id="event-table">
        <thead>
        <tr>
            <th><a href="javascript:update_view(null,'source')">Source<a/></th>
            <th><a href="javascript:update_view(null,'host')">Host</th>
            <th><a href="javascript:update_view(null,'rfc931')">RFC931</th>
            <th><a href="javascript:update_view(null,'username')">Username</th>
            <th><a href="javascript:update_view(null,'when')">Datetime</th>
            <th><a href="javascript:update_view(null,'verb')">Verb</th>
            <th><a href="javascript:update_view(null,'path')">Path</th>
            <th><a href="javascript:update_view(null,'protocol')">Protocol</th>
            <th><a href="javascript:update_view(null,'statuscode')">Statuscode</th>
            <th><a href="javascript:update_view(null,'bytes')">Bytes</th>
        </tr>
        </thead>
        <tbody>
        % for event in events:
        <tr>
            <td>${ event['source'] }</td>
            <td>${ event['host'] }</td>
            <td>${ event['rfc931'] }</td>
            <td>${ event['username'] }</td>
            <td>${ event['when'] }</td>
            <td>${ event['verb'] }</td>
            <td>${ event['path'] }</td>
            <td>${ event['protocol'] }</td>
            <td>${ event['statuscode'] }</td>
            <td>${ event['bytes'] }</td>
        </tr>
        % endfor
        </tbody>
        </table>
        
        % if int(page) > 0:
        <a href="javascript:update_view(${ int(page) - 1 })">Previous</a>
        % endif
        % if (int(page) + 1) * 20 < total_events:
        <a href="javascript:update_view(${ int(page) + 1 })">Next</a>
        % endif
    </div>
    </body>

    <link rel="stylesheet" type="text/css" href="assets/reset.css" />
    <link rel="stylesheet" type="text/css" href="assets/960.css" />
    <link rel="stylesheet" type="text/css" href="assets/text.css" />
    <link rel="stylesheet" type="text/css" href="assets/captainslog.css" />
    <!-- <link rel="stylesheet" type="text/css" href="assets/tablesorter/themes/blue/style.css" /> -->
    <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
    <script type='text/javascript' src='assets/tablesorter/jquery.tablesorter.min.js'></script>
    <script type='text/javascript'>
    var q = {
        'source': '${ selected_source }',
        'when': '${ selected_when }',
        'host': '${ selected_host }',
        'path': '${ selected_path }',
        'statuscode': '${ selected_statuscode }'
        };
        
    function facet_clicked() {    
        q[$(this).parent().parent().attr('name')] = $(this).text();
        
        update_view();
        
        return false;
    }
    
    function update_view(page, sort) {
        if (!page) {
            page = 0;
        }
        
        if (!sort) {
            sort = '${ sort }';
        }
        
        params = new Array();
        
        for (var i in q) {
            params.push(i + '=' + q[i]);
        }
        
        params.push('page=' + page)
        params.push('sort=' + sort)
        
        window.location.href = '?' + params.join('&')
    }
    
    $(document).ready(function () {
        $('.facet').click(function() {
            q[$(this).parent().parent().attr('name')] = $(this).text();
            
            update_view();
            
            return false;
        });
    })
    </script>
</body>